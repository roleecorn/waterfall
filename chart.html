<!DOCTYPE html>

<head>
    <!-- Chart.js v2.4.0 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <script>
        function search(container,searchTypes,inputs) {
            fetch("/search", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "searchTypes": searchTypes,
                    "inputs": inputs
                })
            })
                .then(response => response.json())
                .then(c_data => {
                    c_data = c_data.data;
                    var canvas = document.createElement("canvas");
                    canvas.className = "item";
                    container.appendChild(canvas);
                    var example = new Chart(canvas.getContext("2d"), {
                        type: "bar",
                        data: {
                            labels: c_data.labels,
                            datasets: [
                                {
                                    label: c_data.datasetLabel,
                                    data: c_data.data,
                                    backgroundColor: c_data.backgroundColor,
                                    borderWidth: c_data.borderWidth
                                }
                            ]
                        }
                    });
                })
                .catch(error => {
                    console.error("Error fetching chart data:", error);
                });
        }
        function chart(container, path = '/chart') {
            fetch(path)
                .then(response => response.json())
                .then(c_data => {
                    c_data = c_data.data;
                    var canvas = document.createElement("canvas");
                    canvas.className = "item";
                    container.appendChild(canvas);
                    var example = new Chart(canvas.getContext("2d"), {
                        type: "bar",
                        data: {
                            labels: c_data.labels,
                            datasets: [
                                {
                                    label: c_data.datasetLabel,
                                    data: c_data.data,
                                    backgroundColor: c_data.backgroundColor,
                                    borderWidth: c_data.borderWidth
                                }
                            ]
                        }
                    });
                })
                .catch(error => {
                    console.error("Error fetching chart data:", error);
                });
        }
    </script>
    <style>
        .w {
            width: 80%;
            margin: 0 auto;
        }

        .item {
            width: 25%;
            float: left;
        }
    </style>
</head>

<body>
    <div id="searches">
        <div class="search-block">
            <select class="search-type">
                <option value="name">Name</option>
                <option value="cost">Cost</option>
                <option value="feature">Feature</option>
            </select>
            <input type="text" class="input-field">
        </div>
    </div>
    <button id="add-button">Add</button>
    <button id="remove-button">Remove</button>
    <button id="go-search-button">Go Search</button>
    <div class="w" id="container"></div>
    <script>
        const chartbox = document.getElementById("container");
        
        const addButton = document.getElementById('add-button');
        const removeButton = document.getElementById('remove-button');
        const goSearchButton = document.getElementById('go-search-button');
        const searchesDiv = document.getElementById('searches');

        addButton.addEventListener('click', function () {
            const searchBlock = document.createElement('div');
            searchBlock.className = 'search-block';

            const searchType = document.createElement('select');
            searchType.className = 'search-type';
            searchType.innerHTML = '<option value="name">Name</option><option value="cost">Cost</option><option value="feature">Feature</option>';
            searchBlock.appendChild(searchType);

            const inputField = document.createElement('input');
            inputField.type = 'text';
            inputField.className = 'input-field';
            searchBlock.appendChild(inputField);

            searchesDiv.appendChild(searchBlock);
        });

        removeButton.addEventListener('click', function () {
            const searchBlocks = document.getElementsByClassName('search-block');
            if (searchBlocks.length > 1) {
                searchesDiv.removeChild(searchBlocks[searchBlocks.length - 1]);
            }
        });

        goSearchButton.addEventListener('click', function () {
            const data = {};
            var inputFields = document.getElementsByClassName('search-block');
            var searchTypes = [];
            var inputs = [];
            for (var i = 0; i < inputFields.length; i++) {
                searchTypes.push(inputFields[i].getElementsByClassName('search-type')[0].value);
                inputs.push(inputFields[i].getElementsByClassName('input-field')[0].value);
            }
            console.log(searchTypes);
            console.log(inputs);
            // chart(container);
            search(container,searchTypes,inputs);
            fetch("/search", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "searchTypes": searchTypes,
                    "inputs": inputs
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                })
                .catch(error => {
                    console.error("Error sending search request:", error);
                });
        });

    </script>
</body>